<!DOCTYPE html>
<html>
  <head>
    <title>readMe Lite</title>
    <link rel="stylesheet" href="css/stylesheet.css" />
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <header id="nav">
      <h1 id="logo"><span class="normal-text">read</span ><span
         class="heavy-text">Me</span> <span class="light-text">lite</span></h1>
    </header>
    <div id="book-info-container"></div>
    <div id="content"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="vendor/react.js"></script>
    <script src="vendor/JSXTransformer.js"></script>
    <script type="text/jsx">
      var BookInfo = React.createClass({
        render: function() {
          return (
            <div className="book-info">
              <h2 className="book-title">{'Hover over a book to see more'}</h2>
              <span className="book-author"></span>
              <p className="book-description"></p>
            </div>
          )
        }
      });

      var BookIndexItem = React.createClass({
        mouseIn: function() {
          console.log(this.props.model.cover_url)
          $('#' + this.props.id + ' > img').addClass('grow')
          $('.book-description').html(this.props.model.description)
          $('.book-title').html(this.props.model.title)
          $('.book-author').html('by ' + this.props.model.author_fname + ' ' +
            this.props.model.author_lname)
        },
        mouseOut: function() {
          $('#' + this.props.id + ' > img').removeClass('grow')
        },
        render: function() {
          var classNames = "book-index-item"
          if (this.props.id - 5 > this.props.startIdx ||
               this.props.startIdx > this.props.id) {
            classNames += " hide"
          }
          return (
            <li id={this.props.id} onMouseEnter={this.mouseIn}
            onMouseOut={this.mouseOut}
             className={classNames}>
              <img className="cover-image" src={this.props.model.cover_url} width='90' height='150' alt="" />
            </li>
          );
        }
      });

      var BookIndex = React.createClass({
        loadBooksFromServer: function() {
          $.ajax({
            url: this.props.url,
            dataType: 'json',
            cache: false,
            success: function(data) {
              this.setState({ data: data });
            }.bind(this),
            error: function(xhr, status, err) {
              console.error(this.props.url, status, err.toString());
            }.bind(this)
          })
        },
        clickLeft: function() {
          var newStartIdx = this.state.startIdx - 1
          if (newStartIdx >= 0) {
            this.setState({startIdx: newStartIdx})
          }
        },
        clickRight: function() {
          var newStartIdx = this.state.startIdx + 1
          if (newStartIdx + 5 < this.state.data.length) {
            this.setState({startIdx: newStartIdx})
          }
        },
        getInitialState: function() {
          return {data: [], startIdx: 0}
        },
        componentDidMount: function() {
          this.loadBooksFromServer();
          // setInterval(this.loadBooksFromServer, this.props.pollInterval)
        },
        render: function() {
          var startIdx = this.state.startIdx
          var Books = this.state.data.map(function (book, idx){
            return (
              <BookIndexItem id={idx} startIdx={startIdx} model={book} />
            );
          });
          return (
            <div className="carousel-wrapper">
              <div className="book-carousel">
                <div className="arrow" onClick={this.clickLeft}>{'<'}</div>
                <ul className="book-index">
                  {Books}
                </ul>
                <div className="arrow" onClick={this.clickRight}>{'>'}</div>
              </div>
            </div>
          );
        }
      });
      React.render(
        <BookInfo />,
        document.getElementById('book-info-container')
      );

      React.render(
        <BookIndex url="http://www.try-read.me/api/books"
          pollInterval={3000}/>,
        document.getElementById('content')
      );
    </script>
  </body>
</html>
